# -irex--apper--
Проектът TIREX SAPPER: изграждаме собствен MQL5 EA, който пресъздава логиката на Exorcist (тренд + pullback + усредняваща мрежа), но с прозрачен код, адаптивен риск мениджмънт и лесна оптимизация върху различни символи и таймфреймове.
1. Контекст и цел на проекта

Работим върху проект TIREX SAPPER – собствен експертен съветник (EA) за MetaTrader 5, вдъхновен от поведението на комерсиалния робот Exorcist Bot.

Основни цели:

Да възпроизведем логиката по поведение, а не по код

Използваме визуални бектестове, HTML отчети и реална търговия на Exorcist, за да разберем как се държи:

кога влиза,

как осреднява,

как затваря серията,

как се държи в различни фази на пазара.

НЕ декомпилираме .ex5, не ползваме незаконни методи.

Да създадем прозрачен, четим и разширяем EA

Цел: чист MQL5 код, който всеки специалист може:

да прочете,

да модифицира,

да оптимизира и надгражда.

Да се доближим максимално до „стил А“ на Exorcist

Еднопосочна серия (само BUY или само SELL в даден момент).

Осредняване с фиксиран брой нива, без класически опасен мартингейл.

Работа по тренд, влизане при корекция (pullback), затваряне на серия при целева печалба или риск.

2. Какво знаем за Exorcist (по описание и наблюдение)

От наличното описание и наблюдения:

Exorcist:

е мултивалутен, многофункционален EA;

работи на различни таймфреймове и пазарни условия;

основава се на осредняваща система (average-based grid), но:

с не-геометрична прогресия (без класически мартингейл);

строи мрежа спрямо „важни вътрешни нива“;

има:

SeriaTrendOn и SeriaAntyTrendOn – работа по тренд и/или контра-тренд;

RealStopLoss, RealTakeProfit, VirtStopLoss, VirtTakeProfit;

PendingTrailingOn – trailing на чакащите поръчки;

параметри setLength, setDeviation, setCorrection – вътрешен „leading indicator“.

От кадрите, които анализирахме:

Роботът:

стартира серия с една пазарна сделка (BUY или SELL);

след това поставя мрежа от BUY LIMIT / SELL LIMIT на растящо разстояние;

при движение срещу позицията активира поредни лимити → осреднява входа;

при движение в полза на серията:

трейлва stop loss (видима линия);

затваря серията като цяло при достигане на таргет.

В HTML отчетите:

вижда се разумен профит фактор и умерен drawdown, което потвърждава:

без брутален мартингейл;

при функционални настройки – роботът може да работи „дълго“ без да унищожава сметката.

3. Ограничения и философия

Нямаме достъп до оригиналния сорс код на Exorcist.

Нямаме право да декомпилираме .ex5.

Следователно:

не правим бинарен клон, а поведенчески clone:

копираме идеята и динамиката на стратегията,

но не претендираме, че формулите вътре са идентични.

Крайната цел: самостоятелен робот със сходна логика, но „наш“, а не пиратско копие.

4. Архитектура на TIREX SAPPER (концепция)

Проектът има ясно разделени логически блокове:

Trend Engine (Trend Filter)

В момента използваме:

две EMA: Fast EMA (50) и Slow EMA (100) – параметризирани;

Логика:

Trend UP → EMA_fast > EMA_slow;

Trend DOWN → EMA_fast < EMA_slow;

FLAT → иначе.

Допълнителен сигнален компонент:

Вход при кръстосване на цената през бавната EMA в посока на тренда:

BUY: тренд UP + close(предишна) < slowEMA(предишна) и close(текуща) > slowEMA(текуща);

SELL: тренд DOWN + обратното условие.

Entry Engine (Първи ордер в серия)

При нов бар:

проверяваме:

спред,

часови филтър (по желание),

дали няма вече отворена серия (няма наши сделки).

Ако има BUY сигнал → отваряме първи BUY.

Ако има SELL сигнал → отваряме първи SELL.

Параметри:

фиксиран лот или динамичен (Risk % от баланса);

SL/TP в points.

Grid Engine (Мрежа / Усредняване)

След като има поне 1 сделка в серия, броим:

броя BUY сделки по този символ и Magic;

броя SELL сделки;

намираме:

минимална цена на BUY;

максимална цена на SELL.

Логика:

При BUY серия:

ако текущият ASK падне под minBuyPrice - GridStepPoints, добавяме нов BUY;

При SELL серия:

ако Bид се качи над maxSellPrice + GridStepPoints, добавяме нов SELL.

Ограничения:

максимум сделки в серия: InpMaxGridOrders.

Risk Engine (SL/TP + Risk%)

Всеки ордер получава:

SL = входна цена ± InpStopLossPoints * point;

TP = входна цена ± InpTakeProfitPoints * point.

При динамичен лот:

лотът се изчислява така, че при ударен SL загубата ≈ RiskPerTrade% от баланса;

Целта:

управляем риск,

без безкрайни усреднявания.

Filters Engine

Spread Filter:

не търгува при спред над InpMaxSpreadPoints;

Time Filter:

по избор: търговия само в определен часови диапазон (например избягване на Азия или новини).

Debug/Monitoring Layer

Използваме Comment() за:

текущ тренд (UP / DOWN / FLAT);

стойности на EMA;

брой BUY/SELL позиции;

минимални/максимални цени в серия;

текущ спред.

Това позволява на разработчик/трейдър лесно да вижда какво „мисли“ робота на живо.

5. Текущо състояние на кода (кратко)

Имаме работещ, компилируем TIREX_SAPPER.mq5, който:

Използва:

CTrade клас от Trade.mqh;

стандартни MQL5 функции: iMA, iTime, iClose, PositionsTotal, PositionGet*, SymbolInfo*, AccountInfo*.

Търси сигнали само на нов бар (ограничаваме overtrading).

Поддържа:

фиксиран лот или Risk% лот размер;

grid до InpMaxGridOrders;

линейно осредняване на входните нива (без геометрична прогресия);

SL/TP управление на всяка позиция.

6. Как компенсираме липсата на custom индикаторите от Exorcist

Вместо техните proprietary индикатори:

Trend detection → EMA(50/100)

Leading / wave indicator → кръстосване на цена и бавна EMA + посока на fast vs slow EMA

Important internal levels → минимална/максимална цена в серия + стъпка на мрежата

Protection filters → spread, time, макс. брой позиции, SL/TP, риск %

Важно е да се подчертае, че това са логически заместители, не опити да „изкопираме на сляпо“ неизвестна формула.

7. Какво още трябва да се направи (roadmap)

За да може всеки специалист да продължи проекта, е важно да има план:

7.1. Систематично сравнение с Exorcist

Входни точки:

Визуален backtest на Exorcist и TIREX на един и същ период, символ и TF.

Сравнение:

къде Exorcist отваря серия;

къде TIREX отваря серия;

има ли груба разлика в логиката (примерно Exorcist влиза при по-дълбоки корекции).

Серийна структура:

Колко ордера влезли в серията;

разстояние между тях спрямо GridStep;

позициониране на TP/SL.

Performance метрики:

Net profit;

Drawdown (абсолютен и относителен);

Profit Factor;

Recovery Factor;

Average trade.

Целта не е 1:1 цифри, а сходна форма на equity кривата и сходни поведенчески модели.

7.2. Разширение на филтрите

ATR филтър:

Да не се търгува при твърде ниска или твърде висока волатилност;

Например: ATR(14) * K за динамична стъпка на grid или като допълнителен входен критерий.

Времеви филтър по сесии:

Ясно конфигурирани блокове: Азия, Лондон, Ню Йорк;

Изключване на определени сесии, ако се види, че Exorcist почти не търгува там.

Новинарски филтър (по желание):

Това е по-комплексно (изисква външен feed/API), така че за момента може да се остави за бъдещо разширение.

7.3. Управление на серията (по-сложно)

Общ TP за серията:

Вместо отделен TP на всяка позиция – изчисляване на обща цел за серията (по средна цена и общ обем), както правят много grid системи.

Dynamic Grid:

Стъпката на мрежата да е:

по-малка в началото;

по-голяма след 3–4-ти ордер;

или зависи от волатилност (ATR).

Soft Stop (капитулация на серията):

Праг в пари / % от баланса, при който серията се затваря и се изчаква нов setup;

Това е еквивалент на „VirtStopLossMoney“ от описанието за Exorcist.

8. Какво получава всеки специалист, който влезе в проекта

Чист, компилируем MQL5 EA:

без обфускация;

без външни DLL;

без скрити компоненти.

Логика, която е документирана на ниво блокове:

Trend filter (EMA);

Entry logic (cross + trend);

Grid logic (оседняване);

Risk logic (SL/TP, Risk%);

Filters (spread, time).

Ясна roadmap за развитие:

приближаване до поведението на Exorcist чрез:

настройки,

допълнителни филтри,

евентуално вторични индикатори.

Свобода за надграждане:

може да се добавят:

допълнителни TF филтри (H4, D1);

статистики (OnTester, кастомни репорти);

вътрешен панел с бутони (Start/Stop/Close series);

алтернативни входни сигнали или комбинирани стратегии.
